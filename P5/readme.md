# 五级流水线 CPU 设计方案

设计流程   
1. 流水线寄存器+单指令功能  
2. 阻塞实现  
3. 转发实现  
4. 测试优化

在设计时，可以利用这一点，按照流水级的顺序对每一级的流水寄存器进行实例化，然后在其间插入相应级的模块，并用注释清晰地注明各级起始位置。另外，也可以考虑增加模块层次，将每一流水级的各个模块放入一个父级模块中调用，可以将复杂度有效分散到各个层级。

## CU

分布式译码：每一级都部署一个控制器，负责译出当前级所需控制信号。这种方法较为灵活，“现译现用”有效降低了流水级间传递的信号量，但是需要实例化多个控制器，增加了后续流水级的逻辑复杂度。

控制信号驱动型：为每个指令定义一个 wire 型变量，使用或运算描述组合逻辑，对每个控制信号进行单独处理。这种方法在指令数量较多时适用，且代码量易于压缩，缺陷是如错添或漏添了某条指令，很难锁定出现错误的位置。

指令存储器（IM，instruction memory）和数据存储器（DM，data memory）要求如下：

IM：容量为 16KiB（4096 × 32bit）。
DM：容量为 12KiB（3072 × 32bit）。
PC 的初始地址为 0x00003000，和 Mars 中我们要求设置的代码初始地址相同。


![图 6](images/mips.png)  

# 思考题

1、我们使用提前分支判断的方法尽早产生结果来减少因不确定而带来的开销，但实际上这种方法并非总能提高效率，请从流水线冒险的角度思考其原因并给出一个指令序列的例子。

2、因为延迟槽的存在，对于 jal 等需要将指令地址写入寄存器的指令，要写回 PC + 8，请思考为什么这样设计？

3、我们要求大家所有转发数据都来源于流水寄存器而不能是功能部件（如 DM 、 ALU ），请思考为什么？

4、我们为什么要使用 GPR 内部转发？该如何实现？

5、我们转发时数据的需求者和供给者可能来源于哪些位置？共有哪些转发数据通路？

6、在课上测试时，我们需要你现场实现新的指令，对于这些新的指令，你可能需要在原有的数据通路上做哪些扩展或修改？提示：你可以对指令进行分类，思考每一类指令可能修改或扩展哪些位置。

7、简要描述你的译码器架构，并思考该架构的优势以及不足。

1、[P5 选做] 请详细描述你的测试方案及测试数据构造策略。

2、[P5、P6 选做] 请评估我们给出的覆盖率分析模型的合理性，如有更好的方案，可一并提出。